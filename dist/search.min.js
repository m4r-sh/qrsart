class V{constructor(h=64,_=[],O=[]){if(h<1)throw new Error("Capacity must be positive");if(this._capacity=h,this._objects=new Array(h+1),this._priorities=new Float64Array(h+1),this.length=_.length,_.length!==O.length)throw new Error("Objects/priorities mismatch");if(h<_.length)throw new Error("Capacity too small");for(let f=0;f<_.length;f++)this._objects[f+1]=_[f],this._priorities[f+1]=O[f];for(let f=_.length>>>1;f>=1;f--)this.#_(f)}get capacity(){return this._capacity}clear(){this.length=0}size(){return this.length}#h(h){let _=this._objects[h],O=this._priorities[h];while(h>1){let f=h>>>1;if(this._priorities[f]<=O)break;this._objects[h]=this._objects[f],this._priorities[h]=this._priorities[f],h=f}this._objects[h]=_,this._priorities[h]=O}#_(h){let _=this._objects[h],O=this._priorities[h],f=1+(this.length>>>1),I=this.length+1-1;while(h<f){let X=h<<1,R=this._priorities[X],T=this._objects[X],E=X,N=X+1;if(N<=I&&this._priorities[N]<R)R=this._priorities[N],T=this._objects[N],E=N;if(R>=O)break;this._objects[h]=T,this._priorities[h]=R,h=E}this._objects[h]=_,this._priorities[h]=O}push(h,_){if(this.length===this._capacity)throw new Error("Heap full");let O=this.length+1;this._objects[O]=h,this._priorities[O]=_,this.length++,this.#h(O)}pop(){if(!this.length)return;let h=this._objects[1];if(this._objects[1]=this._objects[this.length+1-1],this._priorities[1]=this._priorities[this.length+1-1],this.length--,this.length>0)this.#_(1);return h}peekPriority(){return this._priorities[1]}peek(){return this._objects[1]}consider(h,_){if(this.length<this._capacity)this.push(_,h);else if(h>this._priorities[1])this._objects[1]=_,this._priorities[1]=h,this.#_(1)}extractAll(){let h=[];while(this.length>0){let _=this._priorities[1],O=this.pop();h.unshift({score:_,object:O})}return h}}var A={case(h="",{enableCaps:_=!1}={}){if(!_)return{total:1,get:(f)=>h};let O=[];for(let f=0;f<h.length;f++)if(h[f].toLowerCase()!==h[f].toUpperCase())O.push(f);return{total:2**O.length,get:(f)=>{let I=h.split("");for(let X=0;X<O.length;X++){let R=O[X];I[R]=f>>X&1?h[R].toUpperCase():h[R].toLowerCase()}return I.join("")}}},group(h=[],{join:_=""}={}){let O=h.map((f)=>typeof f.total==="number"?f.total:1);return{total:O.reduce((f,I)=>f*I,1),get:(f)=>{let I=f,X=[];for(let R=h.length-1;R>=0;R--){let T=O[R],E=I%T;I=Math.floor(I/T),X.unshift(typeof h[R]==="string"?h[R]:h[R].get(E))}return X.join(_)}}},url(h="",{protocolCaps:_=!1,domainCaps:O=!1,pathCaps:f=!1}={}){let[I,X,R,T,E,N]=h.match(/^(https?:\/\/)?([^\/]+)(\/[^?#]*)?(\?[^#]*)?(#.*)?$/i);if(!X||!R)throw"invalid url";let U=A.case(X,{enableCaps:_}),q=A.case(R,{enableCaps:O}),H=A.case(T||"/",{enableCaps:f}),W=A.group([U,q,H]);return{total:W.total,get:($)=>W.get($)+(E||"")+(N||"")}},phone(h="0123456789",{forceCountry:_=!1,validSpacers:O=[""],prefixCaps:f=!1}={}){},email(h="someone@example.com",{perfixCaps:_=!1,domainCaps:O=!1}={}){},emailMessage(h="",{prefixCaps:_=!1,domainCaps:O=!1,queryCaps:f=!1,queryOrdering:I=!0}={}){},sms(h="0123456789",{forceCountry:_=!1,validSpacers:O=[""],prefixCaps:f=!1,queryCaps:I=!1}={}){},wifi({name:h="",password:_=""}){let O=["T:WPA","S:"+h,"P:"+_],f=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,1,0],[2,0,1]];return{total:f.length,get:(I)=>`WIFI:${f[I].map((X)=>O[X]).join(";")};;`}},vcard({name:h="",phone:_="",email:O=""},{}={}){},event({summary:h,dtstart:_},{}={}){},geo({latitude:h="",longitude:_=""}={},{}={}){},bitcoin({address:h,amount:_},{prefixCaps:O=!0,queryCaps:f=!0,queryOrder:I=!0}={}){},ethereum({address:h,amount:_},{prefixCaps:O=!0,queryCaps:f=!0,queryOrder:I=!0}={}){}};var P=[{formatBits:1,codewords_per_block:[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25]},{formatBits:0,codewords_per_block:[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],num_ecc_blocks:[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49]},{formatBits:3,codewords_per_block:[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68]},{formatBits:2,codewords_per_block:[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]}];var{floor:k}=Math,y=[(h,_)=>(h+_)%2==0,(h,_)=>_%2==0,(h,_)=>h%3==0,(h,_)=>(h+_)%3==0,(h,_)=>(k(h/3)+k(_/2))%2==0,(h,_)=>h*_%2+h*_%3==0,(h,_)=>(h*_%2+h*_%3)%2==0,(h,_)=>((h+_)%2+h*_%3)%2==0];class Y{constructor(h,_){this.w=h,this.h=_;let O=h*_,f=Math.ceil(O/32);this.valueBits=new Uint32Array(f),this.usedBits=new Uint32Array(f)}#h(h,_){let O=_*this.w+h;return[O>>5,O&31]}set(h=0,_=0,O=1){if(h<0||h>=this.w||_<0||_>=this.h)return;let[f,I]=this.#h(h,_),X=1<<I;if(O&1)this.valueBits[f]|=X;else this.valueBits[f]&=~X;this.usedBits[f]|=X}get(h=0,_=0){if(h<0||h>=this.w||_<0||_>=this.h)return 0;let[O,f]=this.#h(h,_),I=1<<f;return this.valueBits[O]&I?1:0}used(h=0,_=0){if(h<0||h>=this.w||_<0||_>=this.h)return 0;let[O,f]=this.#h(h,_),I=1<<f;return this.usedBits[O]&I?1:0}*tiles(h=null){let{w:_,h:O,usedBits:f,valueBits:I}=this,X=_*O,R=f.length;for(let T=0;T<R;T++){let E=f[T];if(E===0)continue;let N=I[T],U=T<<5;for(let q=0;q<32;q++){let H=U+q;if(H>=X)break;let W=1<<q;if(!(E&W))continue;let $=(N&W)!==0;if(h==null||!h==!$)yield[H%_,Math.floor(H/_)]}}}toValueArray(){return this.valueBits.slice()}static union(...h){let _=Math.max(...h.map((I)=>I.w)),O=Math.max(...h.map((I)=>I.h)),f=new Y(_,O);for(let I of h)for(let[X,R]of I.tiles())if(!f.get(X,R))f.set(X,R,I.get(X,R));return f}static erase(h,..._){let O=new Y(h.w,h.h);for(let[f,I]of h.tiles())if(!_.some((X)=>X.used(f,I)))O.set(f,I,h.get(f,I));return O}static intersect(h,..._){let O=new Y(h.w,h.h);for(let[f,I]of h.tiles())if(_.every((X)=>X.used(f,I)))O.set(f,I,h.get(f,I));return O}static invert(h){let _=new Y(h.w,h.h);for(let[O,f]of h.tiles())_.set(O,f,!h.get(O,f));return _}}class F{constructor({version:h=2,ecl:_=0,mask:O=0,codewords:f=new Uint8Array}={}){this.version=h,this.ecl=_,this.mask=O,this.codewords=f}get size(){return this.version*4+17}get functional_grid(){let h=new Y(this.size,this.size);return G(h,this),L(h,this),w(h,this),z(h,this),h}get finder_grid(){let h=new Y(this.size,this.size);return G(h,this),h}get timing_grid(){let h=new Y(this.size,this.size);return L(h,this),h}get alignment_grid(){let h=new Y(this.size,this.size);return w(h,this),h}get format_grid(){let h=new Y(this.size,this.size);return l(h,this),h}get version_grid(){let h=new Y(this.size,this.size);return z(h,this),h}get data_grid(){let h=new Y(this.size,this.size);return B(h,this,this.functional_grid),h}get rawdata_grid(){let h=new Y(this.size,this.size);return B(h,this,this.functional_grid,!0),h}get grid(){let h=new Y(this.size,this.size);return G(h,this),L(h,this),w(h,this),z(h,this),B(h,this),h}toBytes(){return new Uint8Array([this.version&255,(this.ecl&3)<<3|(this.mask&7)<<5,...this.codewords])}toString(){let h=this.toBytes(),_="";return h.forEach((O)=>_+=String.fromCharCode(O)),btoa(_)}static fromBytes(h){return new F({version:h[0],ecl:h[1]>>3&3,mask:h[1]>>5&7,codewords:h.slice(2)})}static fromString(h){return F.fromBytes(Uint8Array.from(atob(h),(_)=>_.charCodeAt(0)))}}function B(h,_,O,f=!1){if(!O)O=h;let{codewords:I,mask:X,size:R}=_;l(h,_);let T=0;for(let E=R-1;E>=1;E-=2){if(E===6)E=5;for(let N=0;N<R;N++)for(let U=0;U<2;U++){let q=E-U,W=(E+1&2)===0?R-1-N:N;if(!O.used(q,W)){let D=0;if(T<I.length*8){let J=Math.floor(T/8),Z=7-T%8;D=I[J]>>Z&1}if(f!==!0)D^=y[X](q,W);h.set(q,W,D),T++}}}}function G(h,{size:_}){for(let O=0;O<8;O++)for(let f=0;f<8;f++){let I=Math.max(Math.abs(3-O),Math.abs(3-f))!=2&&!(O==7||f==7);h.set(O,f,I),h.set(_-O-1,f,I),h.set(O,_-f-1,I)}}function L(h,{size:_}){for(let O=8;O<=_-8;O++){let f=O%2==0;h.set(6,O,f),h.set(O,6,f)}}function w(h,{size:_,version:O}){let f=g(O,_),I=f.length;for(let X=0;X<I;X++)for(let R=0;R<I;R++)if(!(X==0&&R==0||X==0&&R==I-1||X==I-1&&R==0))for(let T=-2;T<=2;T++)for(let E=-2;E<=2;E++){let N=Math.max(Math.abs(E),Math.abs(T))==1?0:1;h.set(f[X]+E,f[R]+T,N)}}function l(h,{ecl:_,mask:O,size:f}){let I=P[_].formatBits<<3|O,X=I;for(let T=0;T<10;T++)X=X<<1^(X>>>9)*1335;let R=(I<<10|X)^21522;for(let T=0;T<=5;T++)h.set(8,T,R>>T);h.set(8,7,R>>6),h.set(8,8,R>>7),h.set(7,8,R>>8);for(let T=9;T<15;T++)h.set(14-T,8,R>>T);for(let T=0;T<8;T++)h.set(f-1-T,8,R>>T);for(let T=8;T<15;T++)h.set(8,f-15+T,R>>T);h.set(8,f-8,1)}function z(h,{version:_,size:O}){if(_<7)return;let f=_;for(let X=0;X<12;X++)f=f<<1^(f>>>11)*7973;let I=_<<12|f;for(let X=0;X<18;X++){let R=O-11+X%3,T=Math.floor(X/3);h.set(R,T,I>>X),h.set(T,R,I>>X)}}function g(h,_){if(h==1)return[];let O=Math.floor(h/7)+2,f=h==32?26:Math.ceil((h*4+4)/(O*2-2))*2,I=[6];for(let X=_-7;I.length<O;X-=f)I.splice(1,0,X);return I}var m=/^[0-9]*$/,o=/^[A-Z0-9 $%*+.\/:-]*$/;var s=new TextEncoder,Q={numeric:{modeBits:1,charCost:(h)=>m.test(h)?3.3333333333333335:1/0,numCharCountBits:(h)=>[10,12,14][Math.floor((h+7)/17)],write(h){let _=[];for(let O=0;O<h.length;){let f=Math.min(h.length-O,3);K(parseInt(h.substr(O,f),10),f*3+1,_),O+=f}return _.slice()}},alpha:{modeBits:2,charCost:(h)=>o.test(h)?5.5:1/0,numCharCountBits:(h)=>[9,11,13][Math.floor((h+7)/17)],write(h){let _=[],O;for(O=0;O+2<=h.length;O+=2){let f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O))*45;f+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O+1)),K(f,11,_)}if(O<h.length)K("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O)),6,_);return _.slice()}},byte:{modeBits:4,charCost:(h)=>n(h)*8,numCharCountBits:(h)=>[8,16,16][Math.floor((h+7)/17)],test:(h)=>!0,write(h){let _=s.encode(h),O=[];for(let f of _)K(f,8,O);return O.slice()}}};function K(h,_,O){while(_>31)K(h>>>_-31,31,O),_-=31;if(h>>>_!==0)throw new RangeError("Value out of range");for(let f=_-1;f>=0;f--)O.push(h>>>f&1)}function n(h){let _=h.codePointAt(0);if(_<0)throw"invalid";else if(_<128)return 1;else if(_<2048)return 2;else if(_<65536)return 3;else if(_<1114112)return 4;else throw"invalid"}function c(h){if(h<1||h>255)throw new RangeError("Degree out of range");let _=[];for(let f=0;f<h-1;f++)_.push(0);_.push(1);let O=1;for(let f=0;f<h;f++){for(let I=0;I<_.length;I++)if(_[I]=S(_[I],O),I+1<_.length)_[I]^=_[I+1];O=S(O,2)}return _}function t(h,_){let O=_.map((f)=>0);for(let f of h){let I=f^O.shift();O.push(0),_.forEach((X,R)=>O[R]^=S(X,I))}return O}function S(h,_){if(h>>>8!=0||_>>>8!=0)throw new RangeError("Byte out of range");let O=0;for(let f=7;f>=0;f--)O=O<<1^(O>>>7)*285,O^=(_>>>f&1)*h;return O}function C(h,{minVersion:_=1,maxVersion:O=40,minEcl:f=0,maxEcl:I=3}={}){let X=_,R=f,T;if(Q.numeric.charCost("1")*h.length>j(O,R)*8)throw new Error("Data too long");for(;X<=O;X++){let E=j(X,R)*8;if(X==_||X==10||X==27)T=a(h,X);if(T&&T.cost<=E)break}if(!T||T.cost>j(X,R)*8||X>O)throw new Error("Data too long");for(let E=R+1;E<=I;E++)if(T.cost<=j(X,E)*8)R=E;else break;return{version:X,ecl:R,codewords:x(h,T.steps,X,R),cost:T.cost,steps:T.steps,strategy:r(T.steps),budget:j(X,R)*8}}function r(h){let _=h.map((I)=>["byte","numeric","alpha","kanji"].indexOf(I)),O=Math.ceil(_.length/4),f=new Uint8Array(O);for(let I=0;I<_.length;I++){let X=Math.floor(I/4),R=(3-I%4)*2;f[X]|=(_[I]&3)<<R}return f}function b(h,_,O){let f=j(_,O)*8,I=h.length,X=[new M];for(let R=0;R<I;R++){let T=[];for(let E of X)for(let N of["numeric","alpha","byte"]){let U=Q[N].charCost(h[R]);if(U===1/0)continue;let q=E.lastMode===N?0:4+Q[N].numCharCountBits(_),H=E.cost+q+U;if(E.lastMode!=N)H=Math.ceil(H);if(H>f-(I-1-R)*3.3333333333333335)continue;T.push(E.addStep(N,H))}X=T}return X}function a(h,_){let O=h.length,f=Array(O+1).fill().map(()=>({}));f[0][""]=new M;for(let R=1;R<=O;R++)for(let T in f[R-1]){let E=f[R-1][T];for(let N of["numeric","alpha","byte"]){let U=Q[N].charCost(h[R-1]);if(U===1/0)continue;let q=E.lastMode===N?0:4+Q[N].numCharCountBits(_),H=E.cost+q+U;if(E.lastMode!==N)H=Math.ceil(H);let W=E.addStep(N,H),$=f[R][N];if(!$||W.cost<$.cost)f[R][N]=W}}let I=f[O],X=null;for(let R in I)if(!X||I[R].cost<X.cost)X=I[R];return X?{steps:X.getSteps(),cost:X.cost}:null}function x(h,_,O,f){let I=i(h,_),X=[];for(let{mode:J,str:Z}of I){K(Q[J].modeBits,4,X),K(Z.length,Q[J].numCharCountBits(O),X);for(let u of Q[J].write(Z))X.push(u)}let R=j(O,f)*8;K(0,Math.min(4,R-X.length),X),K(0,(8-X.length%8)%8,X);for(let J=236;X.length<R;J^=253)K(J,8,X);let T=[];while(T.length*8<X.length)T.push(0);X.forEach((J,Z)=>T[Z>>>3]|=J<<7-(Z&7));let E=P[f].num_ecc_blocks[O],N=P[f].codewords_per_block[O],U=Math.floor(p(O)/8),q=E-U%E,H=Math.floor(U/E),W=[],$=c(N);for(let J=0,Z=0;J<E;J++){let u=T.slice(Z,Z+H-N+(J<q?0:1));Z+=u.length;let v=t(u,$);if(J<q)u.push(0);W.push(u.concat(v))}let D=[];for(let J=0;J<W[0].length;J++)W.forEach((Z,u)=>{if(J!=H-N||u>=q)D.push(Z[J])});return new Uint8Array(D)}function p(h){let _=(16*h+128)*h+64;if(h>=2){let O=Math.floor(h/7)+2;_-=(25*O-10)*O-55,_-=h>=7?36:0}return _}function j(h,_){return Math.floor(p(h)/8)-P[_].codewords_per_block[h]*P[_].num_ecc_blocks[h]}function i(h="",_=[]){let O=[],f=_[0],I=0;for(let X=1;X<=h.length;X++)if(X>=h.length||_[X]!=f)O.push({mode:f,str:h.slice(I,X)}),f=_[X],I=X;return O}var e=["byte","numeric","alpha","kanji"],d={byte:0,numeric:1,alpha:2,kanji:3};class M{constructor(h=new Uint8Array(0),_=0,O=0,f=""){this.packed=h,this.length=_,this.cost=O,this.lastMode=f}addStep(h,_){let{length:O,packed:f}=this,I=Math.floor(O/4),X=(3-O%4)*2,R=f.length+(I<f.length?0:1),T=new Uint8Array(R);return T.set(f),T[I]|=d[h]<<X,new M(T,O+1,_,h)}getSteps(){return Array.from({length:this.length},(h,_)=>{let O=this.packed[Math.floor(_/4)],f=(3-_%4)*2;return e[O>>f&3]})}}function Q2(h,_,{capacity:O=20,ecl:f,version:I,tryModes:X=!0}={}){if(f==null||I==null){let E=C(h[0]);if(f==null)f=E.ecl;if(I==null)I=E.version}let R=new V(O),T=[];for(let E of h){let U=b(E,I,f).map((q)=>x(E,q.getSteps(),I,f));for(let q of U)for(let H=0;H<8;H++){let $=new F({version:I,ecl:f,mask:H,codewords:q}),{score:D,...J}=_($);if(R.consider(D,{qr:$,item:E,computed:J}),!X)break}}return R.extractAll().map((E)=>({...E.object,score:E.score}))}function D2(h="url",_="https://qrs.art",O={}){return A[h](_,O)}function*u2(h,_=0,O=1){let{total:f,get:I}=h;for(let X=_;X<f;X+=O)yield I(X)}export{Q2 as search,D2 as permute,A as permutations,C as optimalStrategy,x as constructCodewords,u2 as batch,b as allStrategies};

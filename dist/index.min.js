var N=[{formatBits:1,codewords_per_block:[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25]},{formatBits:0,codewords_per_block:[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],num_ecc_blocks:[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49]},{formatBits:3,codewords_per_block:[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68]},{formatBits:2,codewords_per_block:[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]}];var v=/^[0-9]*$/,m=/^[A-Z0-9 $%*+.\/:-]*$/;var f2=new TextEncoder,h2=[4,3,3],H2=[6,5],A={numeric:{modeBits:1,charCost:(f)=>v.test(f)?3.3333333333333335:1/0,numCharCountBits:(f)=>[10,12,14][Math.floor((f+7)/17)],groupSize:3,getMarginal:(f,h=0)=>v.test(f)?h2[h%3]:1/0,write(f){let h=[];for(let H=0;H<f.length;){let K=Math.min(f.length-H,3);U(parseInt(f.substr(H,K),10),K*3+1,h),H+=K}return h.slice()}},alpha:{modeBits:2,charCost:(f)=>m.test(f)?5.5:1/0,numCharCountBits:(f)=>[9,11,13][Math.floor((f+7)/17)],groupSize:2,getMarginal:(f,h=0)=>m.test(f)?H2[h%2]:1/0,write(f){let h=[],H;for(H=0;H+2<=f.length;H+=2){let K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(H))*45;K+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(H+1)),U(K,11,h)}if(H<f.length)U("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(H)),6,h);return h.slice()}},byte:{modeBits:4,charCost:(f)=>g(f)*8,groupSize:1,numCharCountBits:(f)=>[8,16,16][Math.floor((f+7)/17)],getMarginal:(f,h=0)=>g(f)*8,write(f){let h=f2.encode(f),H=[];for(let K of h)U(K,8,H);return H.slice()}}};function U(f,h,H){while(h>31)U(f>>>h-31,31,H),h-=31;if(f>>>h!==0)throw new RangeError("Value out of range");for(let K=h-1;K>=0;K--)H.push(f>>>K&1)}function g(f){let h=f.codePointAt(0);if(h<0)throw"invalid";else if(h<128)return 1;else if(h<2048)return 2;else if(h<65536)return 3;else if(h<1114112)return 4;else throw"invalid"}function n(f){if(f<1||f>255)throw new RangeError("Degree out of range");let h=[];for(let K=0;K<f-1;K++)h.push(0);h.push(1);let H=1;for(let K=0;K<f;K++){for(let W=0;W<h.length;W++)if(h[W]=u(h[W],H),W+1<h.length)h[W]^=h[W+1];H=u(H,2)}return h}function t(f,h){let H=h.map((K)=>0);for(let K of f){let W=K^H.shift();H.push(0),h.forEach((J,Q)=>H[Q]^=u(J,W))}return H}function u(f,h){if(f>>>8!=0||h>>>8!=0)throw new RangeError("Byte out of range");let H=0;for(let K=7;K>=0;K--)H=H<<1^(H>>>7)*285,H^=(h>>>K&1)*f;return H}function o(f,{minVersion:h=1,maxVersion:H=40,minEcl:K=0,maxEcl:W=3}={}){let J=h,Q=K,Y;if(A.numeric.charCost("1")*f.length>k(H,Q)*8)throw new Error("Data too long");for(;J<=H;J++){let $=k(J,Q)*8;if(J==h||J==10||J==27)Y=Y2(f,J);if(Y&&Y.cost<=$)break}if(!Y||Y.cost>k(J,Q)*8||J>H)throw new Error("Data too long");for(let $=Q+1;$<=W;$++)if(Y.cost<=k(J,$)*8)Q=$;else break;return{version:J,ecl:Q,codewords:a(f,Y,J,Q),strategy:Y}}function*K2(f,h,H){let K=k(h,H)*8,W=f.length,J=[{index:0,strategy:new E}];while(J.length){let{index:Q,strategy:Y}=J.pop();if(Q===W){yield Y;continue}for(let $ of["byte","alpha","numeric"]){let B=A[$].charCost(f[Q]);if(B===1/0)continue;let Z=Y.mode===$?0:4+A[$].numCharCountBits(h),F=Y.cost+Z+B;if(Y.mode!==$)F=Math.ceil(F);let D=(W-1-Q)*3.3333333333333335;if(F>K-D)continue;let O=Y.addStep($,F);J.push({index:Q+1,strategy:O})}}}var J2=["byte","numeric","alpha"],j=3,W2=5,_=W2*j,T={none:0,byte:1,numeric:2,alpha:3,kanji:4},G=[];G[T.none]="none";G[T.byte]="byte";G[T.numeric]="numeric";G[T.alpha]="alpha";G[T.kanji]="kanji";function Y2(f,h=1){let H=f.length,K=new Array(_).fill(null),W=T.none*j+0;K[W]=new E;for(let Y=1;Y<=H;Y++){let $=f[Y-1],B=new Array(_).fill(null);for(let Z=0;Z<_;Z++){if(K[Z]===null)continue;let F=K[Z],D=Math.floor(Z/j),O=Z%j,I=G[D];if(I!=="none"){let V=A[I],q=V.getMarginal($,O);if(q!==1/0){let L=(O+1)%V.groupSize,X=T[I]*j+L,R=F.cost+q,w=F.addStep(I,R);if(B[X]===null||w.cost<B[X].cost)B[X]=w}}for(let V of J2){let q=A[V],L=q.getMarginal($,0);if(L===1/0)continue;let X=4+q.numCharCountBits(h),R=F.cost+X+L,w=1%q.groupSize,M=T[V]*j+w,l=F.addStep(V,R);if(B[M]===null||l.cost<B[M].cost)B[M]=l}}K=B}let J=null,Q=1/0;for(let Y=0;Y<_;Y++)if(K[Y]!==null&&K[Y].cost<Q)Q=K[Y].cost,J=K[Y];return J}function a(f,h,H,K){let W=Q2(f,h),J=[];for(let{mode:q,str:L}of W){U(A[q].modeBits,4,J),U(L.length,A[q].numCharCountBits(H),J);for(let X of A[q].write(L))J.push(X)}let Q=k(H,K)*8;U(0,Math.min(4,Q-J.length),J),U(0,(8-J.length%8)%8,J);for(let q=236;J.length<Q;q^=253)U(q,8,J);let Y=[];while(Y.length*8<J.length)Y.push(0);J.forEach((q,L)=>Y[L>>>3]|=q<<7-(L&7));let $=N[K].num_ecc_blocks[H],B=N[K].codewords_per_block[H],Z=Math.floor(s(H)/8),F=$-Z%$,D=Math.floor(Z/$),O=[],I=n(B);for(let q=0,L=0;q<$;q++){let X=Y.slice(L,L+D-B+(q<F?0:1));L+=X.length;let R=t(X,I);if(q<F)X.push(0);O.push(X.concat(R))}let V=[];for(let q=0;q<O[0].length;q++)O.forEach((L,X)=>{if(q!=D-B||X>=F)V.push(L[q])});return new Uint8Array(V)}function s(f){let h=(16*f+128)*f+64;if(f>=2){let H=Math.floor(f/7)+2;h-=(25*H-10)*H-55,h-=f>=7?36:0}return h}function k(f,h){return Math.floor(s(f)/8)-N[h].codewords_per_block[f]*N[h].num_ecc_blocks[f]}function Q2(f="",h={}){let H=[],K=h.steps,W=K[0],J=0;for(let Q=1;Q<=f.length;Q++)if(Q>=f.length||K[Q]!=W)H.push({mode:W,str:f.slice(J,Q)}),W=K[Q],J=Q;return H}class E{constructor(f=null,h="",H=0,K=0){this.prev=f,this.mode=h,this.cost=H,this.length=K,this._steps=null}addStep(f,h){return new E(this,f,h,this.length+1)}get steps(){if(this._steps)return this._steps;let f=[],h=this;while(h.prev)f.push(h.mode),h=h.prev;return this._steps=f.reverse(),this._steps}}var{floor:d}=Math,x=[(f,h)=>(f+h)%2==0,(f,h)=>h%2==0,(f,h)=>f%3==0,(f,h)=>(f+h)%3==0,(f,h)=>(d(f/3)+d(h/2))%2==0,(f,h)=>f*h%2+f*h%3==0,(f,h)=>(f*h%2+f*h%3)%2==0,(f,h)=>((f+h)%2+f*h%3)%2==0];class P{constructor(f,h){this.w=f,this.h=h;let K=f*h+31>>5;this.valueBits=new Uint32Array(K),this.usedBits=new Uint32Array(K)}#f(f,h){let H=h*this.w+f;return[H>>5,H&31]}set(f=0,h=0,H=1){if(f<0||f>=this.w||h<0||h>=this.h)return;let[K,W]=this.#f(f,h),J=1<<W;if(H&1)this.valueBits[K]|=J;else this.valueBits[K]&=~J;this.usedBits[K]|=J}get(f=0,h=0){if(f<0||f>=this.w||h<0||h>=this.h)return 0;let[H,K]=this.#f(f,h),W=1<<K;return this.valueBits[H]&W?1:0}used(f=0,h=0){if(f<0||f>=this.w||h<0||h>=this.h)return 0;let[H,K]=this.#f(f,h),W=1<<K;return this.usedBits[H]&W?1:0}*tiles(f=null){let{w:h,h:H,usedBits:K,valueBits:W}=this,J=h*H,Q=K.length;for(let Y=0;Y<Q;Y++){let $=K[Y];if($===0)continue;let B=W[Y],Z=Y<<5;for(let F=0;F<32;F++){let D=Z+F;if(D>=J)break;let O=1<<F;if(!($&O))continue;let I=(B&O)!==0;if(f==null||!f==!I)yield[D%h,Math.floor(D/h)]}}}toValueArray(){return this.valueBits.slice()}static union(...f){let h=Math.max(...f.map((W)=>W.w)),H=Math.max(...f.map((W)=>W.h)),K=new P(h,H);for(let W of f)for(let[J,Q]of W.tiles())if(!K.get(J,Q))K.set(J,Q,W.get(J,Q));return K}static erase(f,...h){let H=new P(f.w,f.h);for(let[K,W]of f.tiles())if(!h.some((J)=>J.used(K,W)))H.set(K,W,f.get(K,W));return H}static intersect(f,...h){let H=new P(f.w,f.h);for(let[K,W]of f.tiles())if(h.every((J)=>J.used(K,W)))H.set(K,W,f.get(K,W));return H}static invert(f){let h=new P(f.w,f.h);for(let[H,K]of f.tiles())h.set(H,K,!f.get(H,K));return h}}var C=BigInt(58);function r(f){let h="",H=BigInt(0);for(let K of f)H=H*BigInt(256)+BigInt(K);while(H>0)h="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[Number(H%C)]+h,H=H/C;return h}function i(f){let h=new Map("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".split("").map((W,J)=>[W,BigInt(J)])),H=BigInt(0);for(let W of f){let J=h.get(W);if(J===void 0)throw new Error("Invalid Base58 character");H=H*C+J}let K=[];while(H>0)K.unshift(Number(H%BigInt(256))),H=H/BigInt(256);return new Uint8Array(K)}class z{constructor({version:f=2,ecl:h=0,mask:H=0,codewords:K=new Uint8Array}={}){this.version=f,this.ecl=h,this.mask=H,this.codewords=K}get size(){return this.version*4+17}get functional_grid(){let f=new P(this.size,this.size);return c(f,this),p(f,this),S(f,this),b(f,this),f}get finder_grid(){let f=new P(this.size,this.size);return c(f,this),f}get timing_grid(){let f=new P(this.size,this.size);return p(f,this),f}get alignment_grid(){let f=new P(this.size,this.size);return S(f,this),f}get format_grid(){let f=new P(this.size,this.size);return e(f,this),f}get version_grid(){let f=new P(this.size,this.size);return b(f,this),f}get data_grid(){let f=new P(this.size,this.size);return y(f,this,this.functional_grid),f}get rawdata_grid(){let f=new P(this.size,this.size);return y(f,this,this.functional_grid,!0),f}get grid(){let f=new P(this.size,this.size);return c(f,this),p(f,this),S(f,this),b(f,this),y(f,this),f}toBytes(){return new Uint8Array([this.version&255,(this.ecl&3)<<3|(this.mask&7)<<5,...this.codewords])}toString(){return r(this.toBytes())}static fromBytes(f){return new z({version:f[0],ecl:f[1]>>3&3,mask:f[1]>>5&7,codewords:f.slice(2)})}static fromString(f){return z.fromBytes(i(f))}}function y(f,h,H,K=!1){if(!H)H=f;let{codewords:W,mask:J,size:Q}=h;e(f,h);let Y=0;for(let $=Q-1;$>=1;$-=2){if($===6)$=5;for(let B=0;B<Q;B++)for(let Z=0;Z<2;Z++){let F=$-Z,O=($+1&2)===0?Q-1-B:B;if(!H.used(F,O)){let V=0;if(Y<W.length*8){let q=Math.floor(Y/8),L=7-Y%8;V=W[q]>>L&1}if(K!==!0)V^=x[J](F,O);f.set(F,O,V),Y++}}}}function c(f,{size:h}){for(let H=0;H<8;H++)for(let K=0;K<8;K++){let W=Math.max(Math.abs(3-H),Math.abs(3-K))!=2&&!(H==7||K==7);f.set(H,K,W),f.set(h-H-1,K,W),f.set(H,h-K-1,W)}}function p(f,{size:h}){for(let H=8;H<=h-8;H++){let K=H%2==0;f.set(6,H,K),f.set(H,6,K)}}function S(f,{size:h,version:H}){let K=$2(H,h),W=K.length;for(let J=0;J<W;J++)for(let Q=0;Q<W;Q++)if(!(J==0&&Q==0||J==0&&Q==W-1||J==W-1&&Q==0))for(let Y=-2;Y<=2;Y++)for(let $=-2;$<=2;$++){let B=Math.max(Math.abs($),Math.abs(Y))==1?0:1;f.set(K[J]+$,K[Q]+Y,B)}}function e(f,{ecl:h,mask:H,size:K}){let W=N[h].formatBits<<3|H,J=W;for(let Y=0;Y<10;Y++)J=J<<1^(J>>>9)*1335;let Q=(W<<10|J)^21522;for(let Y=0;Y<=5;Y++)f.set(8,Y,Q>>Y);f.set(8,7,Q>>6),f.set(8,8,Q>>7),f.set(7,8,Q>>8);for(let Y=9;Y<15;Y++)f.set(14-Y,8,Q>>Y);for(let Y=0;Y<8;Y++)f.set(K-1-Y,8,Q>>Y);for(let Y=8;Y<15;Y++)f.set(8,K-15+Y,Q>>Y);f.set(8,K-8,1)}function b(f,{version:h,size:H}){if(h<7)return;let K=h;for(let J=0;J<12;J++)K=K<<1^(K>>>11)*7973;let W=h<<12|K;for(let J=0;J<18;J++){let Q=H-11+J%3,Y=Math.floor(J/3);f.set(Q,Y,W>>J),f.set(Y,Q,W>>J)}}function $2(f,h){if(f==1)return[];let H=Math.floor(f/7)+2,K=f==32?26:Math.ceil((f*4+4)/(H*2-2))*2,W=[6];for(let J=h-7;W.length<H;J-=K)W.splice(1,0,J);return W}function w2(f="",{minVersion:h=1,maxVersion:H=40,minEcl:K=0,maxEcl:W=3,ecl:J=null,version:Q=null,mask:Y=0}={}){if(Q)h=H=Q;if(J)K=W=J;let $=o(f,{minVersion:h,minEcl:K,maxEcl:W,maxVersion:H});return new z({mask:Y,version:$.version,ecl:$.ecl,codewords:$.codewords})}export{o as optimalStrategy,w2 as createQR,a as constructCodewords,K2 as allStrategies,z as QRCode,x as MASK_SHAPES,P as Grid,N as ECLS};

class q{constructor(h=64,_=[],O=[]){if(h<1)throw new Error("Capacity must be positive");if(this._capacity=h,this._objects=new Array(h+1),this._priorities=new Float64Array(h+1),this.length=_.length,_.length!==O.length)throw new Error("Objects/priorities mismatch");if(h<_.length)throw new Error("Capacity too small");for(let f=0;f<_.length;f++)this._objects[f+1]=_[f],this._priorities[f+1]=O[f];for(let f=_.length>>>1;f>=1;f--)this.#_(f)}get capacity(){return this._capacity}clear(){this.length=0}size(){return this.length}#h(h){let _=this._objects[h],O=this._priorities[h];while(h>1){let f=h>>>1;if(this._priorities[f]<=O)break;this._objects[h]=this._objects[f],this._priorities[h]=this._priorities[f],h=f}this._objects[h]=_,this._priorities[h]=O}#_(h){let _=this._objects[h],O=this._priorities[h],f=1+(this.length>>>1),X=this.length+1-1;while(h<f){let t=h<<1,T=this._priorities[t],E=this._objects[t],I=t,R=t+1;if(R<=X&&this._priorities[R]<T)T=this._priorities[R],E=this._objects[R],I=R;if(T>=O)break;this._objects[h]=E,this._priorities[h]=T,h=I}this._objects[h]=_,this._priorities[h]=O}push(h,_){if(this.length===this._capacity)throw new Error("Heap full");let O=this.length+1;this._objects[O]=h,this._priorities[O]=_,this.length++,this.#h(O)}pop(){if(!this.length)return;let h=this._objects[1];if(this._objects[1]=this._objects[this.length+1-1],this._priorities[1]=this._priorities[this.length+1-1],this.length--,this.length>0)this.#_(1);return h}peekPriority(){return this._priorities[1]}peek(){return this._objects[1]}consider(h,_){if(this.length<this._capacity)this.push(_,h);else if(h>this._priorities[1])this._objects[1]=_,this._priorities[1]=h,this.#_(1)}extractAll(){let h=[];while(this.length>0){let _=this._priorities[1],O=this.pop();h.unshift({score:_,object:O})}return h}}var j={case(h="",{enableCaps:_=!1}={}){if(!_)return{total:1,get:(f)=>h};let O=[];for(let f=0;f<h.length;f++)if(h[f].toLowerCase()!==h[f].toUpperCase())O.push(f);return{total:2**O.length,get:(f)=>{let X=h.split("");for(let t=0;t<O.length;t++){let T=O[t];X[T]=f>>t&1?h[T].toUpperCase():h[T].toLowerCase()}return X.join("")}}},group(h=[],{join:_=""}={}){let O=h.map((f)=>typeof f.total==="number"?f.total:1);return{total:O.reduce((f,X)=>f*X,1),get:(f)=>{let X=f,t=[];for(let T=h.length-1;T>=0;T--){let E=O[T],I=X%E;X=Math.floor(X/E),t.unshift(typeof h[T]==="string"?h[T]:h[T].get(I))}return t.join(_)}}},url(h="",{protocolCaps:_=!1,domainCaps:O=!1,pathCaps:f=!1}={}){let[X,t,T,E,I,R]=h.match(/^(https?:\/\/)?([^\/]+)(\/[^?#]*)?(\?[^#]*)?(#.*)?$/i);if(!t||!T)throw"invalid url";let N=j.case(t,{enableCaps:_}),A=j.case(T,{enableCaps:O}),F=j.case(E||"/",{enableCaps:f}),D=j.group([N,A,F]);return{total:D.total,get:(w)=>D.get(w)+(I||"")+(R||"")}},phone(h="0123456789",{forceCountry:_=!1,validSpacers:O=[""],prefixCaps:f=!1}={}){},email(h="someone@example.com",{perfixCaps:_=!1,domainCaps:O=!1}={}){},emailMessage(h="",{prefixCaps:_=!1,domainCaps:O=!1,queryCaps:f=!1,queryOrdering:X=!0}={}){},sms(h="0123456789",{forceCountry:_=!1,validSpacers:O=[""],prefixCaps:f=!1,queryCaps:X=!1}={}){},wifi({name:h="",password:_=""}){let O=["T:WPA","S:"+h,"P:"+_],f=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,1,0],[2,0,1]];return{total:f.length,get:(X)=>`WIFI:${f[X].map((t)=>O[t]).join(";")};;`}},vcard({name:h="",phone:_="",email:O=""},{}={}){},event({summary:h,dtstart:_},{}={}){},geo({latitude:h="",longitude:_=""}={},{}={}){},bitcoin({address:h,amount:_},{prefixCaps:O=!0,queryCaps:f=!0,queryOrder:X=!0}={}){},ethereum({address:h,amount:_},{prefixCaps:O=!0,queryCaps:f=!0,queryOrder:X=!0}={}){}};var Y=[{formatBits:1,codewords_per_block:[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25]},{formatBits:0,codewords_per_block:[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],num_ecc_blocks:[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49]},{formatBits:3,codewords_per_block:[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68]},{formatBits:2,codewords_per_block:[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]}];var{floor:k}=Math,b=[(h,_)=>(h+_)%2==0,(h,_)=>_%2==0,(h,_)=>h%3==0,(h,_)=>(h+_)%3==0,(h,_)=>(k(h/3)+k(_/2))%2==0,(h,_)=>h*_%2+h*_%3==0,(h,_)=>(h*_%2+h*_%3)%2==0,(h,_)=>((h+_)%2+h*_%3)%2==0];class H{constructor(h,_){this.w=h,this.h=_,this.data=new Uint8Array(Math.ceil(h*_/4))}#h(h,_){let O=_*this.w+h;return[O>>2,(O&3)<<1]}set(h=0,_=0,O=1){if(h<0||h>=this.w||_<0||_>=this.h)return;let[f,X]=this.#h(h,_),t=3<<X,T=(O&1)<<X|1<<X+1;this.data[f]=this.data[f]&~t|T}get(h=0,_=0){if(h<0||h>=this.w||_<0||_>=this.h)return 0;let[O,f]=this.#h(h,_);return this.data[O]>>f&1}used(h=0,_=0){if(h<0||h>=this.w||_<0||_>=this.h)return 0;let[O,f]=this.#h(h,_);return this.data[O]>>f+1&1}*tiles(h=null){let{w:_,h:O,data:f}=this,X=_*O;for(let t=0;t<f.length;t++){let T=f[t];if(T===0)continue;let E=t<<2;for(let I=0;I<4;I++){let R=E+I;if(R>=X)break;let N=I<<1;if(!(T&2<<N))continue;let F=T&1<<N;if(h==null||!h==!F)yield[R%_,Math.floor(R/_)]}}}static union(...h){let _=Math.max(...h.map((X)=>X.w)),O=Math.max(...h.map((X)=>X.h)),f=new H(_,O);for(let X of h)for(let[t,T]of X.tiles())if(!f.get(t,T))f.set(t,T,X.get(t,T));return f}static erase(h,..._){let O=new H(h.w,h.h);for(let[f,X]of h.tiles())if(!_.some((t)=>t.used(f,X)))O.set(f,X,h.get(f,X));return O}static intersect(h,..._){let O=new H(h.w,h.h);for(let[f,X]of h.tiles())if(_.every((t)=>t.used(f,X)))O.set(f,X,h.get(f,X));return O}static invert(h){let _=new H(h.w,h.h);for(let[O,f]of h.tiles())_.set(O,f,!h.get(O,f));return _}}class Q{constructor({version:h=2,ecl:_=0,mask:O=0,codewords:f=new Uint8Array}={}){this.version=h,this.ecl=_,this.mask=O,this.codewords=f}get size(){return this.version*4+17}get functional_grid(){let h=new H(this.size,this.size);return M(h,this),P(h,this),G(h,this),V(h,this),L(h,this),h}get finder_grid(){let h=new H(this.size,this.size);return M(h,this),h}get timing_grid(){let h=new H(this.size,this.size);return P(h,this),h}get alignment_grid(){let h=new H(this.size,this.size);return G(h,this),h}get format_grid(){let h=new H(this.size,this.size);return V(h,this),h}get version_grid(){let h=new H(this.size,this.size);return L(h,this),h}get data_grid(){let h=new H(this.size,this.size);return u(h,this,this.functional_grid),h}get grid(){let h=new H(this.size,this.size);return M(h,this),P(h,this),G(h,this),V(h,this),L(h,this),u(h,this),h}toBytes(){return new Uint8Array([this.version&255,(this.ecl&3)<<3|(this.mask&7)<<5,...this.codewords])}toString(){let h=this.toBytes(),_="";return h.forEach((O)=>_+=String.fromCharCode(O)),btoa(_)}static fromBytes(h){return new Q({version:h[0],ecl:h[1]>>3&3,mask:h[1]>>5&7,codewords:h.slice(2)})}static fromString(h){return Q.fromBytes(Uint8Array.from(atob(h),(_)=>_.charCodeAt(0)))}}function u(h,{codewords:_,mask:O,size:f},X){if(!X)X=h;let t=0;for(let T=f-1;T>=1;T-=2){if(T===6)T=5;for(let E=0;E<f;E++)for(let I=0;I<2;I++){let R=T-I,A=(T+1&2)===0?f-1-E:E;if(!X.used(R,A)){let D=0;if(t<_.length*8){let w=Math.floor(t/8),$=7-t%8;D=_[w]>>$&1}D^=b[O](R,A),h.set(R,A,D),t++}}}}function M(h,{size:_}){for(let O=0;O<8;O++)for(let f=0;f<8;f++){let X=Math.max(Math.abs(3-O),Math.abs(3-f))!=2&&!(O==7||f==7);h.set(O,f,X),h.set(_-O-1,f,X),h.set(O,_-f-1,X)}}function P(h,{size:_}){for(let O=8;O<=_-8;O++){let f=O%2==0;h.set(6,O,f),h.set(O,6,f)}}function G(h,{size:_,version:O}){let f=s(O,_),X=f.length;for(let t=0;t<X;t++)for(let T=0;T<X;T++)if(!(t==0&&T==0||t==0&&T==X-1||t==X-1&&T==0))for(let E=-2;E<=2;E++)for(let I=-2;I<=2;I++){let R=Math.max(Math.abs(I),Math.abs(E))==1?0:1;h.set(f[t]+I,f[T]+E,R)}}function V(h,{ecl:_,mask:O,size:f}){let X=Y[_].formatBits<<3|O,t=X;for(let E=0;E<10;E++)t=t<<1^(t>>>9)*1335;let T=(X<<10|t)^21522;for(let E=0;E<=5;E++)h.set(8,E,T>>E);h.set(8,7,T>>6),h.set(8,8,T>>7),h.set(7,8,T>>8);for(let E=9;E<15;E++)h.set(14-E,8,T>>E);for(let E=0;E<8;E++)h.set(f-1-E,8,T>>E);for(let E=8;E<15;E++)h.set(8,f-15+E,T>>E);h.set(8,f-8,1)}function L(h,{version:_,size:O}){if(_<7)return;let f=_;for(let t=0;t<12;t++)f=f<<1^(f>>>11)*7973;let X=_<<12|f;for(let t=0;t<18;t++){let T=O-11+t%3,E=Math.floor(t/3);h.set(T,E,X>>t),h.set(E,T,X>>t)}}function s(h,_){if(h==1)return[];let O=Math.floor(h/7)+2,f=h==32?26:Math.ceil((h*4+4)/(O*2-2))*2,X=[6];for(let t=_-7;X.length<O;t-=f)X.splice(1,0,t);return X}var i=/^[0-9]*$/,p=/^[A-Z0-9 $%*+.\/:-]*$/;var n=new TextEncoder,J={numeric:{modeBits:1,charCost:(h)=>i.test(h)?3.3333333333333335:1/0,numCharCountBits:(h)=>[10,12,14][Math.floor((h+7)/17)],write(h){let _=[];for(let O=0;O<h.length;){let f=Math.min(h.length-O,3);U(parseInt(h.substr(O,f),10),f*3+1,_),O+=f}return _.slice()}},alpha:{modeBits:2,charCost:(h)=>p.test(h)?5.5:1/0,numCharCountBits:(h)=>[9,11,13][Math.floor((h+7)/17)],write(h){let _=[],O;for(O=0;O+2<=h.length;O+=2){let f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O))*45;f+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O+1)),U(f,11,_)}if(O<h.length)U("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(h.charAt(O)),6,_);return _.slice()}},byte:{modeBits:4,charCost:(h)=>r(h)*8,numCharCountBits:(h)=>[8,16,16][Math.floor((h+7)/17)],test:(h)=>!0,write(h){let _=n.encode(h),O=[];for(let f of _)U(f,8,O);return O.slice()}}};function U(h,_,O){while(_>31)U(h>>>_-31,31,O),_-=31;if(h>>>_!==0)throw new RangeError("Value out of range");for(let f=_-1;f>=0;f--)O.push(h>>>f&1)}function r(h){let _=h.codePointAt(0);if(_<0)throw"invalid";else if(_<128)return 1;else if(_<2048)return 2;else if(_<65536)return 3;else if(_<1114112)return 4;else throw"invalid"}function c(h){if(h<1||h>255)throw new RangeError("Degree out of range");let _=[];for(let f=0;f<h-1;f++)_.push(0);_.push(1);let O=1;for(let f=0;f<h;f++){for(let X=0;X<_.length;X++)if(_[X]=S(_[X],O),X+1<_.length)_[X]^=_[X+1];O=S(O,2)}return _}function C(h,_){let O=_.map((f)=>0);for(let f of h){let X=f^O.shift();O.push(0),_.forEach((t,T)=>O[T]^=S(t,X))}return O}function S(h,_){if(h>>>8!=0||_>>>8!=0)throw new RangeError("Byte out of range");let O=0;for(let f=7;f>=0;f--)O=O<<1^(O>>>7)*285,O^=(_>>>f&1)*h;return O}function g(h,{minVersion:_=1,maxVersion:O=40,minEcl:f=0,maxEcl:X=3}={}){let t=_,T=f,E;if(J.numeric.charCost("1")*h.length>Z(O,T)*8)throw new Error("Data too long");for(;t<=O;t++){let I=Z(t,T)*8;if(t==_||t==10||t==27)E=m(h,t);if(E&&E.cost<=I)break}if(!E||E.cost>Z(t,T)*8||t>O)throw new Error("Data too long");for(let I=T+1;I<=X;I++)if(E.cost<=Z(t,I)*8)T=I;else break;return{version:t,ecl:T,codewords:B(h,E.steps,t,T),cost:E.cost,steps:E.steps,strategy:y(E.steps),budget:Z(t,T)*8}}function y(h){let _=h.map((X)=>["byte","numeric","alpha","kanji"].indexOf(X)),O=Math.ceil(_.length/4),f=new Uint8Array(O);for(let X=0;X<_.length;X++){let t=Math.floor(X/4),T=(3-X%4)*2;f[t]|=(_[X]&3)<<T}return f}function x(h,_,O){let f=Z(_,O)*8,X=h.length,t=[{cost:0,steps:[],mode:""}];for(let T=0;T<X;T++){let E=[];for(let I of t)for(let R of["numeric","alpha","byte"]){let N=J[R].charCost(h[T]);if(N===1/0)continue;let A=I.mode===R?0:4+J[R].numCharCountBits(_),F=I.cost+A+N;if(F>f)continue;E.push({cost:F,steps:[...I.steps,R],strategy:y(I.steps),mode:R})}t=E}return t}function m(h,_){let O=h.length,f=Array(O+1).fill().map(()=>({}));f[0]={"":{cost:0,steps:[]}};let X=0;for(let I=1;I<=O;I++)for(let R in f[I-1]){let N=f[I-1][R];for(let A of["numeric","alpha","byte"]){let F=J[A].charCost(h[I-1]);if(F===1/0)continue;let D=R===A?0:4+J[A].numCharCountBits(_),w=N.cost+D+F;if(!f[I][A]||w<f[I][A].cost)f[I][A]={cost:w,steps:[...N.steps,A]}}}let t=f[O],T=1/0,E="";for(let I in t)if(t[I].cost<T)T=t[I].cost,E=I;return t[E]?{steps:t[E].steps,cost:t[E].cost}:null}function B(h,_,O,f){let X=o(h,_),t=[];for(let{mode:z,str:K}of X){U(J[z].modeBits,4,t),U(K.length,J[z].numCharCountBits(O),t);for(let W of J[z].write(K))t.push(W)}let T=Z(O,f)*8;U(0,Math.min(4,T-t.length),t),U(0,(8-t.length%8)%8,t);for(let z=236;t.length<T;z^=253)U(z,8,t);let E=[];while(E.length*8<t.length)E.push(0);t.forEach((z,K)=>E[K>>>3]|=z<<7-(K&7));let I=Y[f].num_ecc_blocks[O],R=Y[f].codewords_per_block[O],N=Math.floor(l(O)/8),A=I-N%I,F=Math.floor(N/I),D=[],w=c(R);for(let z=0,K=0;z<I;z++){let W=E.slice(K,K+F-R+(z<A?0:1));K+=W.length;let v=C(W,w);if(z<A)W.push(0);D.push(W.concat(v))}let $=[];for(let z=0;z<D[0].length;z++)D.forEach((K,W)=>{if(z!=F-R||W>=A)$.push(K[z])});return new Uint8Array($)}function l(h){let _=(16*h+128)*h+64;if(h>=2){let O=Math.floor(h/7)+2;_-=(25*O-10)*O-55,_-=h>=7?36:0}return _}function Z(h,_){return Math.floor(l(h)/8)-Y[_].codewords_per_block[h]*Y[_].num_ecc_blocks[h]}function o(h="",_=[]){let O=[],f=_[0],X=0;for(let t=1;t<=h.length;t++)if(t>=h.length||_[t]!=f)O.push({mode:f,str:h.slice(X,t)}),f=_[t],X=t;return O}function K2(h,_,{capacity:O=20,ecl:f,version:X}={}){if(f==null||X==null){let E=g(h[0]);if(f==null)f=E.ecl;if(X==null)X=E.version}let t=new q(O),T=[];for(let E of h){let R=x(E,X,f).map((N)=>B(E,N.steps,X,f));for(let N of R)for(let A=0;A<8;A++){let D=new Q({version:X,ecl:f,mask:A,codewords:N}),{score:w,...$}=_(D);t.consider(w,{qr:D,item:E,computed:$})}}return t.extractAll().map((E)=>({...E.object,score:E.score}))}function U2(h="url",_="https://qrs.art",O={}){return j[h](_,O)}function w2(h={},{start:_=0,stride:O=1,limit:f=null,loop:X=null}={}){let{total:t,get:T}=h;if(f==null)f=t;if(X==null)X=t;let E=[];for(let I=0;I<f;I++){let R=(_+I*O)%X;if(R>=t)continue;E.push(T(R))}return E}export{K2 as search,U2 as permute,j as permutations,g as optimalStrategy,B as constructCodewords,w2 as batch,x as allStrategies};

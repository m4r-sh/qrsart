var P=[{formatBits:1,codewords_per_block:[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25]},{formatBits:0,codewords_per_block:[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],num_ecc_blocks:[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49]},{formatBits:3,codewords_per_block:[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68]},{formatBits:2,codewords_per_block:[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],num_ecc_blocks:[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]}];var y=/^[0-9]*$/,p=/^[A-Z0-9 $%*+.\/:-]*$/;var g=new TextEncoder,w={numeric:{modeBits:1,charCost:(f)=>y.test(f)?3.3333333333333335:1/0,numCharCountBits:(f)=>[10,12,14][Math.floor((f+7)/17)],write(f){let _=[];for(let h=0;h<f.length;){let A=Math.min(f.length-h,3);$(parseInt(f.substr(h,A),10),A*3+1,_),h+=A}return _.slice()}},alpha:{modeBits:2,charCost:(f)=>p.test(f)?5.5:1/0,numCharCountBits:(f)=>[9,11,13][Math.floor((f+7)/17)],write(f){let _=[],h;for(h=0;h+2<=f.length;h+=2){let A="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(h))*45;A+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(h+1)),$(A,11,_)}if(h<f.length)$("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(f.charAt(h)),6,_);return _.slice()}},byte:{modeBits:4,charCost:(f)=>m(f)*8,numCharCountBits:(f)=>[8,16,16][Math.floor((f+7)/17)],test:(f)=>!0,write(f){let _=g.encode(f),h=[];for(let A of _)$(A,8,h);return h.slice()}}};function $(f,_,h){while(_>31)$(f>>>_-31,31,h),_-=31;if(f>>>_!==0)throw new RangeError("Value out of range");for(let A=_-1;A>=0;A--)h.push(f>>>A&1)}function m(f){let _=f.codePointAt(0);if(_<0)throw"invalid";else if(_<128)return 1;else if(_<2048)return 2;else if(_<65536)return 3;else if(_<1114112)return 4;else throw"invalid"}function j(f){if(f<1||f>255)throw new RangeError("Degree out of range");let _=[];for(let A=0;A<f-1;A++)_.push(0);_.push(1);let h=1;for(let A=0;A<f;A++){for(let F=0;F<_.length;F++)if(_[F]=G(_[F],h),F+1<_.length)_[F]^=_[F+1];h=G(h,2)}return _}function k(f,_){let h=_.map((A)=>0);for(let A of f){let F=A^h.shift();h.push(0),_.forEach((z,H)=>h[H]^=G(z,F))}return h}function G(f,_){if(f>>>8!=0||_>>>8!=0)throw new RangeError("Byte out of range");let h=0;for(let A=7;A>=0;A--)h=h<<1^(h>>>7)*285,h^=(_>>>A&1)*f;return h}function B(f,{minVersion:_=1,maxVersion:h=40,minEcl:A=0,maxEcl:F=3}={}){let z=_,H=A,K;if(w.numeric.charCost("1")*f.length>I(h,H)*8)throw new Error("Data too long");for(;z<=h;z++){let Q=I(z,H)*8;if(z==_||z==10||z==27)K=l(f,z);if(K&&K.cost<=Q)break}if(!K||K.cost>I(z,H)*8||z>h)throw new Error("Data too long");for(let Q=H+1;Q<=F;Q++)if(K.cost<=I(z,Q)*8)H=Q;else break;return{version:z,ecl:H,codewords:u(f,K.steps,z,H),cost:K.cost,steps:K.steps,strategy:c(K.steps),budget:I(z,H)*8}}function c(f){let _=f.map((F)=>["byte","numeric","alpha","kanji"].indexOf(F)),h=Math.ceil(_.length/4),A=new Uint8Array(h);for(let F=0;F<_.length;F++){let z=Math.floor(F/4),H=(3-F%4)*2;A[z]|=(_[F]&3)<<H}return A}function v(f,_,h){let A=I(_,h)*8,F=f.length,z=[{cost:0,steps:[],mode:""}];for(let H=0;H<F;H++){let K=[];for(let Q of z)for(let T of["numeric","alpha","byte"]){let W=w[T].charCost(f[H]);if(W===1/0)continue;let q=Q.mode===T?0:4+w[T].numCharCountBits(_),Y=Q.cost+q+W;if(Y>A)continue;K.push({cost:Y,steps:[...Q.steps,T],strategy:c(Q.steps),mode:T})}z=K}return z}function l(f,_){let h=f.length,A=Array(h+1).fill().map(()=>({}));A[0]={"":{cost:0,steps:[]}};let F=0;for(let Q=1;Q<=h;Q++)for(let T in A[Q-1]){let W=A[Q-1][T];for(let q of["numeric","alpha","byte"]){let Y=w[q].charCost(f[Q-1]);if(Y===1/0)continue;let X=T===q?0:4+w[q].numCharCountBits(_),O=W.cost+X+Y;if(!A[Q][q]||O<A[Q][q].cost)A[Q][q]={cost:O,steps:[...W.steps,q]}}}let z=A[h],H=1/0,K="";for(let Q in z)if(z[Q].cost<H)H=z[Q].cost,K=Q;return z[K]?{steps:z[K].steps,cost:z[K].cost}:null}function u(f,_,h,A){let F=o(f,_),z=[];for(let{mode:J,str:Z}of F){$(w[J].modeBits,4,z),$(Z.length,w[J].numCharCountBits(h),z);for(let M of w[J].write(Z))z.push(M)}let H=I(h,A)*8;$(0,Math.min(4,H-z.length),z),$(0,(8-z.length%8)%8,z);for(let J=236;z.length<H;J^=253)$(J,8,z);let K=[];while(K.length*8<z.length)K.push(0);z.forEach((J,Z)=>K[Z>>>3]|=J<<7-(Z&7));let Q=P[A].num_ecc_blocks[h],T=P[A].codewords_per_block[h],W=Math.floor(C(h)/8),q=Q-W%Q,Y=Math.floor(W/Q),X=[],O=j(T);for(let J=0,Z=0;J<Q;J++){let M=K.slice(Z,Z+Y-T+(J<q?0:1));Z+=M.length;let b=k(M,O);if(J<q)M.push(0);X.push(M.concat(b))}let R=[];for(let J=0;J<X[0].length;J++)X.forEach((Z,M)=>{if(J!=Y-T||M>=q)R.push(Z[J])});return new Uint8Array(R)}function C(f){let _=(16*f+128)*f+64;if(f>=2){let h=Math.floor(f/7)+2;_-=(25*h-10)*h-55,_-=f>=7?36:0}return _}function I(f,_){return Math.floor(C(f)/8)-P[_].codewords_per_block[f]*P[_].num_ecc_blocks[f]}function o(f="",_=[]){let h=[],A=_[0],F=0;for(let z=1;z<=f.length;z++)if(z>=f.length||_[z]!=A)h.push({mode:A,str:f.slice(F,z)}),A=_[z],F=z;return h}var{floor:x}=Math,S=[(f,_)=>(f+_)%2==0,(f,_)=>_%2==0,(f,_)=>f%3==0,(f,_)=>(f+_)%3==0,(f,_)=>(x(f/3)+x(_/2))%2==0,(f,_)=>f*_%2+f*_%3==0,(f,_)=>(f*_%2+f*_%3)%2==0,(f,_)=>((f+_)%2+f*_%3)%2==0];class U{constructor(f,_){this.w=f,this.h=_,this.data=new Uint8Array(Math.ceil(f*_/4))}#f(f,_){let h=_*this.w+f;return[h>>2,(h&3)<<1]}set(f=0,_=0,h=1){if(f<0||f>=this.w||_<0||_>=this.h)return;let[A,F]=this.#f(f,_),z=3<<F,H=(h&1)<<F|1<<F+1;this.data[A]=this.data[A]&~z|H}get(f=0,_=0){if(f<0||f>=this.w||_<0||_>=this.h)return 0;let[h,A]=this.#f(f,_);return this.data[h]>>A&1}used(f=0,_=0){if(f<0||f>=this.w||_<0||_>=this.h)return 0;let[h,A]=this.#f(f,_);return this.data[h]>>A+1&1}*tiles(f=null){let{w:_,h,data:A}=this,F=_*h;for(let z=0;z<A.length;z++){let H=A[z];if(H===0)continue;let K=z<<2;for(let Q=0;Q<4;Q++){let T=K+Q;if(T>=F)break;let W=Q<<1;if(!(H&2<<W))continue;let Y=H&1<<W;if(f==null||!f==!Y)yield[T%_,Math.floor(T/_)]}}}static union(...f){let _=Math.max(...f.map((F)=>F.w)),h=Math.max(...f.map((F)=>F.h)),A=new U(_,h);for(let F of f)for(let[z,H]of F.tiles())if(!A.get(z,H))A.set(z,H,F.get(z,H));return A}static erase(f,..._){let h=new U(f.w,f.h);for(let[A,F]of f.tiles())if(!_.some((z)=>z.used(A,F)))h.set(A,F,f.get(A,F));return h}static intersect(f,..._){let h=new U(f.w,f.h);for(let[A,F]of f.tiles())if(_.every((z)=>z.used(A,F)))h.set(A,F,f.get(A,F));return h}static invert(f){let _=new U(f.w,f.h);for(let[h,A]of f.tiles())_.set(h,A,!f.get(h,A));return _}}class t{constructor({version:f=2,ecl:_=0,mask:h=0,codewords:A=new Uint8Array}={}){this.version=f,this.ecl=_,this.mask=h,this.codewords=A}get size(){return this.version*4+17}get functional_grid(){let f=new U(this.size,this.size);return D(f,this),L(f,this),N(f,this),V(f,this),E(f,this),f}get finder_grid(){let f=new U(this.size,this.size);return D(f,this),f}get timing_grid(){let f=new U(this.size,this.size);return L(f,this),f}get alignment_grid(){let f=new U(this.size,this.size);return N(f,this),f}get format_grid(){let f=new U(this.size,this.size);return V(f,this),f}get version_grid(){let f=new U(this.size,this.size);return E(f,this),f}get data_grid(){let f=new U(this.size,this.size);return n(f,this,this.functional_grid),f}get grid(){let f=new U(this.size,this.size);return D(f,this),L(f,this),N(f,this),V(f,this),E(f,this),n(f,this),f}toBytes(){return new Uint8Array([this.version&255,(this.ecl&3)<<3|(this.mask&7)<<5,...this.codewords])}toString(){let f=this.toBytes(),_="";return f.forEach((h)=>_+=String.fromCharCode(h)),btoa(_)}static fromBytes(f){return new t({version:f[0],ecl:f[1]>>3&3,mask:f[1]>>5&7,codewords:f.slice(2)})}static fromString(f){return t.fromBytes(Uint8Array.from(atob(f),(_)=>_.charCodeAt(0)))}}function n(f,{codewords:_,mask:h,size:A},F){if(!F)F=f;let z=0;for(let H=A-1;H>=1;H-=2){if(H===6)H=5;for(let K=0;K<A;K++)for(let Q=0;Q<2;Q++){let T=H-Q,q=(H+1&2)===0?A-1-K:K;if(!F.used(T,q)){let X=0;if(z<_.length*8){let O=Math.floor(z/8),R=7-z%8;X=_[O]>>R&1}X^=S[h](T,q),f.set(T,q,X),z++}}}}function D(f,{size:_}){for(let h=0;h<8;h++)for(let A=0;A<8;A++){let F=Math.max(Math.abs(3-h),Math.abs(3-A))!=2&&!(h==7||A==7);f.set(h,A,F),f.set(_-h-1,A,F),f.set(h,_-A-1,F)}}function L(f,{size:_}){for(let h=8;h<=_-8;h++){let A=h%2==0;f.set(6,h,A),f.set(h,6,A)}}function N(f,{size:_,version:h}){let A=r(h,_),F=A.length;for(let z=0;z<F;z++)for(let H=0;H<F;H++)if(!(z==0&&H==0||z==0&&H==F-1||z==F-1&&H==0))for(let K=-2;K<=2;K++)for(let Q=-2;Q<=2;Q++){let T=Math.max(Math.abs(Q),Math.abs(K))==1?0:1;f.set(A[z]+Q,A[H]+K,T)}}function V(f,{ecl:_,mask:h,size:A}){let F=P[_].formatBits<<3|h,z=F;for(let K=0;K<10;K++)z=z<<1^(z>>>9)*1335;let H=(F<<10|z)^21522;for(let K=0;K<=5;K++)f.set(8,K,H>>K);f.set(8,7,H>>6),f.set(8,8,H>>7),f.set(7,8,H>>8);for(let K=9;K<15;K++)f.set(14-K,8,H>>K);for(let K=0;K<8;K++)f.set(A-1-K,8,H>>K);for(let K=8;K<15;K++)f.set(8,A-15+K,H>>K);f.set(8,A-8,1)}function E(f,{version:_,size:h}){if(_<7)return;let A=_;for(let z=0;z<12;z++)A=A<<1^(A>>>11)*7973;let F=_<<12|A;for(let z=0;z<18;z++){let H=h-11+z%3,K=Math.floor(z/3);f.set(H,K,F>>z),f.set(K,H,F>>z)}}function r(f,_){if(f==1)return[];let h=Math.floor(f/7)+2,A=f==32?26:Math.ceil((f*4+4)/(h*2-2))*2,F=[6];for(let z=_-7;F.length<h;z-=A)F.splice(1,0,z);return F}function W2(f="",{minVersion:_=1,maxVersion:h=40,minEcl:A=0,maxEcl:F=3,ecl:z=null,version:H=null,mask:K=0}={}){if(H)_=h=H;if(z)A=F=z;let Q=B(f,{minVersion:_,minEcl:A,maxEcl:F,maxVersion:h});return new t({mask:K,version:Q.version,ecl:Q.ecl,codewords:Q.codewords})}export{B as optimalStrategy,W2 as createQR,u as constructCodewords,v as allStrategies,t as QRCode,S as MASK_SHAPES,U as Grid,P as ECLS};
